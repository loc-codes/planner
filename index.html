<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Daily Planner Issue Redirector</title>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const today = new Date();

            // Day of week: 0=Sun, 1=Mon, 2=Tue, 3=Wed, 4=Thu, 5=Fri, 6=Sat
            const dayOfWeek = today.getDay();

            // Format date as dd/mm/yyyy
            const formattedToday = `${String(today.getDate()).padStart(2, '0')}/` +
                                   `${String(today.getMonth() + 1).padStart(2, '0')}/` +
                                   `${today.getFullYear()}`;

            // Pick template based on day
            let template = 'office.yml';
            if (dayOfWeek === 2) {
                template = 'tuesday.yml';
            } else if (dayOfWeek === 4) {
                template = 'thursday.yml';
            }

            fetch(`issue-titles.json?${Math.random()}`)
                .then(response => response.json())
                .then(issues => {
                    const matchingIssue = issues.find(issue =>
                        issue.title.startsWith(formattedToday)
                    );

                    if (matchingIssue) {
                        window.location.href = matchingIssue.url;
                    } else {
                        const fullDateOptions = {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        };
                        const fullDateString = today
                            .toLocaleDateString('en-GB', fullDateOptions)
                            .replace(/,/g, '');

                        const title = fullDateString;
                        const encodedTitle = encodeURIComponent(title);

                        window.location.href =
                            `https://github.com/loc-codes/planner/issues/new` +
                            `?template=${template}` +
                            `&title=${encodedTitle}`;
                    }
                })
                .catch(error =>
                    console.error('Error fetching issue titles:', error)
                );
        });
    </script>
</head>
<body>
    <h1>Redirecting...</h1>
</body>
</html>
